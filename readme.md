# Joints' Motion Controller
> 通过线性或三次曲线的方法控制机械臂关节运动，以保证末端按照目标轨迹运动，本控制器设计主要用于适配23赛季工程代码的参数服务器架构，同时可以有效降低各模块的耦合度。

## 实现的功能：

- 对个人设定的轨迹点进行线性插值运算
  - 对MoveIt/运动学逆解算器下发的轨迹点的关节值&目标速度进行三次插值运算
  - 各关节速度联动，在某一关节不能达到目标速度的情况下，等比减小各关节速度，以保证末端运动轨迹不变
  - 经过单片机实测，由于单片机堆栈资源的限制和缺乏内存管理的情况，使用vector会导致内存碎片最终失去内存分配能力，采用freertos的heap4内存管理则由于指针难以查看内存，难以debug，故最终决定采用定长数组的方式进行存储和运算。

- 使用方法：
  - 使用前，确定关节数量和最大轨迹点数量
  - 创建`MotionControllerClassdef`对象，并在构造函数中传入目标指针和freertos执行的频率
  - 调用`setJointSpeedLimit`函数设置关节速度限制
  - 调用`receiveTracjectory`函数接收轨迹点数据
  - 调用`interpolation`进行插值运算
  - 以上的代码只需要在`JointControl`函数调用前调用一次
  - 调用`JointControl`函数，该函数需要在任务中循环调用以实现增量控制
  - 在构造函数中可以设置是否跟随真实时间，跟随真实时间时，请设置目标函数执行的周期为**<u>10ms</u>**，轨迹点时间间隔不低于**<u>0.1s</u>**，此时轨迹点时间单位为秒。任一条件不满足将自动不跟随真实时间。